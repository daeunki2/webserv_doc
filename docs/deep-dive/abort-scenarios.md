---
sidebar_position: 4
---

# 서버는 언제 요청 처리를 중단해야 하는가 (abort scenarios)

이 문서는
webserv에서 가장 판단이 어려운 질문에 답한다.

> “이 요청은 언제 더 이상 처리할 의미가 없어지는가?”

abort는 오류 처리나 예외 처리가 아니다.  
abort는 **의미가 사라진 작업을 즉시 중단하는 결정**이다.

---

## abort란 무엇인가
abort는
요청 처리가 “실패”했기 때문에 발생하는 것이 아니다.
요청 처리가 **더 이상 유효하지 않기 때문에** 발생한다.

즉 abort는 다음을 의미한다.

- 이 요청은 더 이상 완료되어도 의미가 없다
- 남은 처리는 서버 자원만 소모한다
- 즉시 중단하고 정리해야 한다

abort는 timeout과 다르다.
timeout은 “idle 연결 정리”이고,
abort는 “무의미한 작업 중단”이다.

---

## 클라이언트가 연결을 끊는 순간
가장 명확한 abort 시나리오는
클라이언트가 연결을 끊는 경우다.

클라이언트 소켓이 닫혔다는 것은,
그 이후 어떤 응답도
클라이언트에게 전달될 수 없다는 뜻이다.

이 시점에서 서버가 해야 할 일은 명확하다.

- 더 이상 응답을 만들 필요가 없다
- 진행 중인 요청 처리는 의미를 잃는다
- 관련된 모든 상태와 자원을 정리해야 한다

연결이 사라진 요청을
끝까지 처리하는 것은
서버 입장에서 순수한 낭비이다.

---

## CGI 실행 중 클라이언트가 사라진 경우
CGI 실행 중 클라이언트가 연결을 끊는 경우는
abort 판단이 가장 중요한 상황이다.

CGI는
서버 외부에서 실행되는 별도의 프로세스이며,
이미 실행되었다고 해서
반드시 끝까지 돌려야 할 이유는 없다.

클라이언트가 사라진 순간,
CGI의 출력은 더 이상 전달될 대상이 없다.
이때 서버는 다음 결정을 내려야 한다.

- CGI 실행 결과는 더 이상 의미가 없다
- CGI 프로세스를 중단한다
- CGI와 연결된 파이프 FD를 모두 정리한다

이 상황을 timeout으로 처리하면 안 된다.
이는 idle 문제가 아니라
**의미 상실 문제**이기 때문이다.

---

## timeout으로 인한 강제 중단
timeout은 abort의 한 원인이 될 수 있다.

idle timeout이 발생했다는 것은,
클라이언트가 일정 시간 동안
아무런 활동을 하지 않았다는 뜻이다.
이 시점에서 서버는
요청 처리를 계속할 이유를 잃는다.

따라서 timeout 발생 시 서버는:

- 해당 연결을 종료하고
- 진행 중인 요청이 있다면 abort 처리하며
- CGI가 실행 중이라면 함께 정리한다

중요한 점은,
timeout은 abort를 **유발**할 수 있지만,
abort 자체와 동일한 개념은 아니라는 것이다.

---

## abort와 정상 종료의 차이
abort와 정상 종료의 가장 큰 차이는
“마무리 단계”의 존재 여부다.

정상 종료의 경우:
- 응답을 끝까지 생성하고
- 모든 데이터를 전송한 뒤
- 연결을 정리한다

abort의 경우:
- 응답 완성을 보장하지 않는다
- 남은 처리를 즉시 중단한다
- 자원 정리를 최우선으로 수행한다

abort 상황에서
“정상적인 HTTP 응답”을 보내려고 시도하는 것은
오히려 위험할 수 있다.

---

## abort 시 서버가 반드시 정리해야 할 것들
abort는
단순히 연결을 닫는 것으로 끝나지 않는다.
서버는 반드시 다음 자원들을 정리해야 한다.

- 클라이언트 소켓 FD
- CGI와 연결된 모든 파이프 FD
- 실행 중인 CGI 프로세스
- 요청/응답 상태 객체
- poll에 등록된 이벤트 항목

이 정리가 누락되면,
FD 누수, 좀비 프로세스,
poll 오염과 같은 문제가 발생한다.

abort는 “중단”이 아니라
**정리까지 포함한 결정**이다.

---

## 이 설계가 서버 안정성에 미치는 영향
abort 시나리오를 명확히 정의하면,
서버는 다음과 같은 이점을 얻는다.

- 의미 없는 작업을 즉시 중단할 수 있다
- 서버 자원을 불필요하게 점유하지 않는다
- 예외 상황에서도 이벤트 루프를 깨지 않는다
- 장시간 실행 시에도 안정성을 유지한다

webserv에서 abort는
부가 기능이 아니라
**이벤트 기반 서버를 성립시키는 핵심 설계 요소**이다.

---

## 정리
timeout과 abort는 경쟁 관계가 아니다.

- timeout은 idle 연결을 정리하기 위한 정책이고
- abort는 의미를 잃은 작업을 중단하기 위한 결정이다

CGI, 대용량 요청, 느린 처리와 같은 상황에서
서버가 흔들리지 않으려면,
abort 기준이 반드시 명확해야 한다.

이 문서는
그 기준을 명시적으로 드러내기 위해 존재한다.
